loadCollapsibles("collapsible");
const ICON_EXPAND = '<img src="/inlineframe/onebooking/hub/assets/page/adc/rb/icons/arrow_expand_opc.svg" alt="Expand" class="arrowImagesDown">';
const ICON_COLLAPSE = '<img src="/inlineframe/onebooking/hub/assets/page/adc/rb/icons/arrow_collapse_opc.svg" alt="Collapse" class="arrowImagesUp">';
const LX_ICON_COLLAPSE = '<img src="/inlineframe/onebooking/hub/assets/page/adc/rb/icons/arrow-up-LX.svg" alt="Collapse" class="lx-open-collapse-icon">';
const LX_ICON_EXPAND = '<img src="/inlineframe/onebooking/hub/assets/page/adc/rb/icons/arrow-down-LX.svg" alt="Expand" class="lx-open-expand-icon">';

function loadCollapsibles(className) {
    var coll = document.getElementsByClassName(className);
    var i;
    for (i = 0; i < coll.length; i++) {
        var borderTop = "1px solid rgba(68, 44, 46, 0.12)";
        var borderRadius = "0.3rem";
        coll[i].addEventListener("click", function () {
            toggleCollapsible(this, className, borderTop, borderRadius);
        });
        coll[i].addEventListener("keydown", function (event) {
            if (event.key === "Enter" || event.key === " ") {
                event.preventDefault();
                toggleCollapsible(this, className, borderTop, borderRadius);
            }
        });
    }
}

function toggleCollapsible(element, className, borderTop, borderRadius) {
    element.classList.toggle("active");
    var icon = searchIcon(element);
    var content = element.nextElementSibling;
    var tableId = element.getAttribute('data-table-id');
    var card_table = tableId ? document.getElementById(tableId) : null;
    if (content.offsetHeight > 0) {
        content.style.height = "0px";
        element.style.borderBottom = borderTop;
        element.style.borderRadius = borderRadius;
        if (icon) {
            icon.textContent = "";
        }
        if (className === 'collapsible-opcDetails') {
            let span;
            element.style.borderBottom = "";
            element.style.borderRadius = "";
            if(element.classList.contains("first")) {
                span = document.querySelector('.arrow-expand-icon-insideEU');
            } else {
                span = document.querySelector('.arrow-expand-icon-outsideEU');
            }
            if(span.innerHTML.includes('class="lx-open-collapse-icon')){
                span.innerHTML = LX_ICON_EXPAND;
            }else if (!span.innerHTML.includes('class="opc-open-collapse-icon')) {
                span.innerHTML = ICON_EXPAND;
            }
            content.style.padding = "0px 0px 0px 0px";
            if (className === 'collapsible-opcDetails' && card_table) {
                card_table.classList.remove('cards-table-1');
            }
        }
    } else {
        if (className === 'collapsible-opcDetails') {
            content.style.height = "250px";
            let span;
            if(element.classList.contains("first")) {
                span = document.querySelector('.arrow-expand-icon-insideEU');
            } else {
                span = document.querySelector('.arrow-expand-icon-outsideEU');
            }
            if(span.innerHTML.includes('class="lx-open-expand-icon')){
                span.innerHTML = LX_ICON_COLLAPSE;
            }else if (!span.innerHTML.includes('class="opc-open-collapse-icon"')) {
                span.innerHTML = ICON_COLLAPSE;
            }
            content.style.padding = "0px 24px 30px 0px";
            if (className === 'collapsible-opcDetails' && card_table) {
                card_table.classList.add('cards-table-1');
            }
        } else {
            content.style.height = "100%";
        }
        element.style.borderBottom = "0";
        element.style.borderBottomLeftRadius = "0px";
        element.style.borderBottomRightRadius = "0px";
        if (icon) {
            icon.textContent = "";
        }
    }
}

function searchIcon(node) {
    if(node.classList && (node.classList.contains("open-collapse-icon")
                            || node.classList.contains("opc-open-collapse-icon"))) {
        return node;
    }
    node = node.firstChild;
    while(node) {
        icon = searchIcon(node);
        if(icon) {
            return icon;
        }
        else {
            node = node.nextSibling;
        }
    }
}